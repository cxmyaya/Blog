{"remainingRequest":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\丫丫\\web\\CODE\\blog\\sifou\\src\\pages\\user\\views\\ChatHome.vue?vue&type=style&index=0&id=9f417d5a&scoped=true&lang=css&","dependencies":[{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\src\\pages\\user\\views\\ChatHome.vue","mtime":1610954820428},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jaGF0LXdyYXBwZXJ7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogY2FsYygxMDB2aCAtIDI0cHgpOwp9Ci5jb250ZW50LWFyZWF7CiAgaGVpZ2h0OmNhbGMoMTAwJSAtIDQwcHgpOwogIG92ZXJmbG93LXk6IGF1dG87Cn0KLnRvb2wtYmFyewogIHBvc2l0aW9uOmFic29sdXRlOwogIGxlZnQ6IDA7CiAgYm90dG9tOiAwOwogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OjQwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQouc2VsZWN0LWltZzpob3ZlcnsKICBjb2xvcjojNDA5RUZGCn0KLm1zZy1ib3g6OmFmdGVyewogIGNvbnRlbnQ6Jyc7CiAgZGlzcGxheTogYmxvY2s7CiAgY2xlYXI6Ym90aAp9Ci5lbC1jYXJkX19ib2R5ewogIHBhZGRpbmc6MTBweAp9Cg=="},{"version":3,"sources":["ChatHome.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatHome.vue","sourceRoot":"src/pages/user/views","sourcesContent":["<template>\r\n  <div>\r\n    <el-page-header @back=\"goBack\">\r\n    </el-page-header>\r\n    <div class=\"chat-wrapper\">\r\n      <div class=\"content-area\" ref='contentArea'>\r\n      <div class=\"msg-box\"  v-for='(item, index) in msgList' :key='index'>\r\n        <div\r\n        :style=\"{\r\n          float:item.type === 'me' ? 'right' : 'left',\r\n          padding:'10px'\r\n        }\"\r\n        >\r\n        <div \r\n        :style=\"{\r\n          float:item.type === 'me' ? 'right' : 'left'\r\n        }\">\r\n          <el-avatar :size=\"40\" :src='item.avatar' style=\"display: block;margin: 0 auto\"></el-avatar>\r\n          <span style='font-size: 12px;'>{{item.userName}}</span>\r\n        </div>\r\n        <el-card\r\n        :style=\"{\r\n          float:item.type === 'me' ? 'right' : 'left',\r\n          margin:'0 10px'\r\n        }\">\r\n          <span v-if=\"item.msg.type==='text'\">{{item.msg.content}}</span>\r\n          <el-image v-else :src=\"item.msg.content\"></el-image>\r\n        </el-card>\r\n        \r\n        </div>\r\n      </div>\r\n      </div>\r\n      <div class=\"tool-bar\">\r\n        <el-row style=\" text-align: center;box-shadow: 0 0px 10px 1px #ccc\">\r\n          <el-col :span='2' style=\"line-height: 40px; cursor: pointer;\" class=\"select-img\">\r\n            <i class=\"el-icon-picture-outline\" style=\"cursor: pointer;\"></i>\r\n            <input @change='sendImg' type=\"file\" ref='selectImg' style=\"position: absolute;z-index: 10;top: 0;left: 0;opacity: 0;\">\r\n          </el-col>\r\n          <el-col :span='20'>\r\n            <el-input v-model=\"msgText\" @keypress.enter.native='sendText'></el-input>\r\n          </el-col>\r\n          <el-col :span='2'>\r\n            <el-button type=\"text\" icon='el-icon-s-promotion' @click='sendText'></el-button>\r\n          </el-col>\r\n        </el-row>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  async function cutImageBase64(files, width, quality){\r\n    return new Promise((res => {\r\n      const file = files[0]\r\n      let URL = window.URL || Window.webkitURL\r\n      let blob = URL.createObjectURL(file) //获取当前文件的一个内存URL\r\n      let base64\r\n      const img = new Image()\r\n      img.src = blob\r\n      img.onload = function(){\r\n        let w = this.width\r\n        let h = this.height\r\n        let scale = w / h\r\n        w = width || w\r\n        h = w / scale\r\n        const canvas = document.createElement('canvas')\r\n        const canCon = canvas.getContext('2d')\r\n        canvas.width = w \r\n        canvas.height = h\r\n        canCon.drawImage(this, 0, 0, w, h)\r\n        let ext = this.src.substring(this.src.lastIndexOf(\".\") + 1).toLowerCase();\r\n        base64 = canvas.toDataURL('image/'+ext, quality || 0.8)\r\n        res(base64)\r\n      }\r\n    }))\r\n\r\n  }\r\n  import defaultConfig from '@/config/config.default'\r\n  export default {\r\n    name: \"chatHome\",\r\n    data(){\r\n      return {\r\n        socket:null,\r\n        msgText:'',\r\n        message:{\r\n          userName:'',\r\n          avatar:'',\r\n          msg:{\r\n            type:'',\r\n            content:' '\r\n          }\r\n        },\r\n        userData:JSON.parse(sessionStorage.getItem('userData')),\r\n        msgList:[]\r\n      }\r\n    },\r\n    watch:{\r\n      userData:{\r\n        handler(){\r\n          this.message.userName = this.userData.userName\r\n          this.message.avatar = this.userData.avatar\r\n        },\r\n        immediate:true\r\n      }\r\n    },\r\n    mounted(){\r\n      this.socket = new WebSocket(`${defaultConfig.wssApiUrl}`)\r\n      let vm = this\r\n\r\n      //成功连接聊天室\r\n      this.socket.addEventListener('open',function(){\r\n        vm.$message.success('加入聊天室')\r\n      })\r\n\r\n      //接收信息\r\n      this.socket.addEventListener('message',function(event){\r\n        vm.msgList.push({\r\n          ...JSON.parse(event.data),\r\n          type:'other'\r\n        })\r\n        vm.$nextTick(() => {\r\n          vm.$refs.contentArea.scrollTop = vm.$refs.contentArea.scrollHeight\r\n        })\r\n      })\r\n    },\r\n    methods:{\r\n      goBack(){\r\n        this.$router.go(-1)\r\n      },\r\n      sendImg(){\r\n        cutImageBase64(this.$refs.selectImg.files, 400, 0.6).then(rs => {\r\n          this.message.msg.type = 'img'\r\n          this.message.msg.content = rs\r\n          this.socket.send(JSON.stringify(this.message))\r\n          this.msgList.push({\r\n            ...JSON.parse(JSON.stringify(this.message)),\r\n            type:'me'\r\n          })\r\n          this.$nextTick(() => {\r\n            this.$refs.contentArea.scrollTop = this.$refs.contentArea.scrollHeight\r\n          })\r\n          this.message.msg.type = ''\r\n          this.message.msg.content = '  '\r\n        })\r\n      },\r\n      sendText(){\r\n        if(!this.msgText){\r\n          this.$message.warning('不能发送空消息')\r\n          return \r\n        }\r\n        this.message.msg.type = 'text'\r\n        this.message.msg.content = this.msgText\r\n        this.socket.send(JSON.stringify(this.message)) //发送信息\r\n        this.msgText = ''\r\n        this.msgList.push({\r\n          ...JSON.parse(JSON.stringify(this.message)),\r\n          type:'me'\r\n        })\r\n        this.$nextTick(() => {\r\n          this.$refs.contentArea.scrollTop = this.$refs.contentArea.scrollHeight\r\n        })\r\n        this.message.msg.type = ''\r\n        this.message.msg.content = '  '\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .chat-wrapper{\r\n    position: relative;\r\n    width: 100%;\r\n    height: calc(100vh - 24px);\r\n  }\r\n  .content-area{\r\n    height:calc(100% - 40px);\r\n    overflow-y: auto;\r\n  }\r\n  .tool-bar{\r\n    position:absolute;\r\n    left: 0;\r\n    bottom: 0;\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    height:40px;\r\n    background-color: #fff;\r\n  }\r\n  .select-img:hover{\r\n    color:#409EFF\r\n  }\r\n  .msg-box::after{\r\n    content:'';\r\n    display: block;\r\n    clear:both\r\n  }\r\n  .el-card__body{\r\n    padding:10px\r\n  }\r\n</style>\r\n<!--\r\n  保持长连接\r\n    服务器上主动给用户发送信息\r\n    socket(套接字)\r\n\r\n  轮询：\r\n    每隔一段时间就向后端发送请求\r\n\r\n-->"]}]}