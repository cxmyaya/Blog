{"remainingRequest":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\丫丫\\web\\CODE\\blog\\sifou\\src\\components\\Global-Comment.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\src\\components\\Global-Comment.vue","mtime":1609082113020},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\丫丫\\web\\CODE\\blog\\sifou\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBCbG9nU2VydmljZSBmcm9tICdAL3NlcnZpY2UvQmxvZ1NlcnZpY2UnCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiR2xvYmFsQ29tbWVudCIsCiAgcHJvcHM6ewogICAgYmxvZ0lkOnsKICAgICAgdHlwZTpOdW1iZXIsCiAgICAgIGRlZmF1bHQ6MAogICAgfSwKICAgIGNvbW1lbnRzOnsKICAgICAgdHlwZTpBcnJheSwKICAgICAgZGVmYXVsdCgpewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICB9CiAgfSwKICB3YXRjaDp7CiAgICBjb21tZW50czp7CiAgICAgIGhhbmRsZXIoKXsKICAgICAgICB0aGlzLmxvY2FsQ29tbWVudCA9IHRoaXMuY29tbWVudHMuc2xpY2UoMCkKICAgICAgfSwKICAgICAgaW1tZWRpYXRlOnRydWUKICAgIH0KICB9LAogIGRhdGEoKXsKICAgIHJldHVybiB7CiAgICAgIGFydGljbGVDb21tZW50U3RyOicnLAogICAgICBjb21tZW50U3RyOicnLAogICAgICBsb2NhbENvbW1lbnQ6W10sCiAgICAgIGlzQ29tbWVudDp0cnVlLAogICAgICB1c2VyRGF0YTpKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJEYXRhJykpLAoKICAgIH0KICB9LAogIGZpbHRlcnM6ewogICAgdHJhbnNmb3JtVGltZSh0aW1lKXsKICAgICAgbGV0IGJsb2dDcmVhdGVUaW1lID0gbmV3IERhdGUodGltZSkKICAgICAgbGV0IGN1cnJlbnRUaW1lID0gbmV3IERhdGUoKQogICAgICBsZXQgb2Zmc2V0VGltZSA9IGN1cnJlbnRUaW1lIC0gYmxvZ0NyZWF0ZVRpbWUKICAgICAgbGV0IG9mZnNldFNUID0gb2Zmc2V0VGltZSAvIDEwMDAKICAgICAgbGV0IG9mZnNldE1UID0gb2Zmc2V0U1QgLyA2MAogICAgICBsZXQgb2Zmc2V0SFQgPSBvZmZzZXRNVCAvIDYwCiAgICAgIGxldCBvZmZzZXREVCA9IG9mZnNldEhUIC8gMjQKICAgICAgaWYob2Zmc2V0RFQgPj0gMzY1KXsKICAgICAgICByZXR1cm4gYOWPkeihqOS6jiAke01hdGguZmxvb3Iob2Zmc2V0RFQgLyAzNjUpfSDlubTkuYvliY1gCiAgICAgIH1lbHNlIGlmKG9mZnNldERUID49IDMwKXsKICAgICAgICByZXR1cm4gYOWPkeihqOS6jiAke01hdGguZmxvb3Iob2Zmc2V0RFQgLyAzMCl9IOS4quaciOS5i+WJjWAKICAgICAgfWVsc2UgaWYob2Zmc2V0RFQgPj0gNyl7CiAgICAgICAgcmV0dXJuIGDlj5Hooajkuo4gJHtNYXRoLmZsb29yKG9mZnNldERUIC8gNyl9IOWRqOS5i+WJjWAKICAgICAgfWVsc2UgaWYob2Zmc2V0RFQgPj0gMSl7CiAgICAgICAgcmV0dXJuIGDlj5Hooajkuo4gJHtNYXRoLmZsb29yKG9mZnNldERUKX0g5aSp5LmL5YmNYAogICAgICB9ZWxzZSBpZihvZmZzZXRIVCA+PSAxKXsKICAgICAgICByZXR1cm4gYOWPkeihqOS6jiAke01hdGguZmxvb3Iob2Zmc2V0SFQpfSDlsI/ml7bkuYvliY1gCiAgICAgIH0KICAgICAgZWxzZSBpZihvZmZzZXRNVCA+PSAxKXsKICAgICAgICByZXR1cm4gYOWPkeihqOS6jiAke01hdGguZmxvb3Iob2Zmc2V0TVQpfSDliIbpkp/kuYvliY1gCiAgICAgIH0KICAgICAgZWxzZSBpZihvZmZzZXRTVCA+PSAwKXsKICAgICAgICAvLyByZXR1cm4gYOWPkeihqOS6jiAke01hdGguZmxvb3Iob2Zmc2V0U1QpfSDnp5Lpkp/kuYvliY1gCiAgICAgICAgcmV0dXJuICfliJrliJonCiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6ewogICAgc3dpdGNoQ29tbWVudChjb21tZW50SXRlbSl7CiAgICAgIHRoaXMubG9jYWxDb21tZW50LmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaWYoaXRlbSAhPSBjb21tZW50SXRlbSl7CiAgICAgICAgICBpdGVtLmlzQ29tbWVudCA9IGZhbHNlCiAgICAgICAgfQogICAgICB9KQogICAgICBjb21tZW50SXRlbS5pc0NvbW1lbnQgPSAhY29tbWVudEl0ZW0uaXNDb21tZW50CiAgICAgICAgaWYoIWNvbW1lbnRJdGVtLmlzQ29tbWVudCl7CiAgICAgICAgICB0aGlzLmlzQ29tbWVudCA9IHRydWUKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHRoaXMuaXNDb21tZW50ID0gZmFsc2UKICAgICAgICB9CiAgICB9LAogICAgY2FuY2VsQ29tbWVudCh0YXJnZXQsdHlwZSl7CiAgICAgIHN3aXRjaCh0eXBlKXsKICAgICAgICBjYXNlICdmYXRoZXInOgogICAgICAgICAgdGhpcy5hcnRpY2xlQ29tbWVudFN0ciA9ICcnCiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzb24nOgogICAgICAgICAgdGhpcy5jb21tZW50U3RyID0gJycKICAgICAgICAgIHRhcmdldC5pc0NvbW1lbnQgPSBmYWxzZQogICAgICAgICAgdGhpcy5pc0NvbW1lbnQgPSB0cnVlCiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKICAgIGFkZENvbW1lbnQodGFyZ2V0LCB0eXBlKXsKICAgICAgbGV0IGNvbW1lbnREYXRhID0gewogICAgICAgIGZhdGhlcklkOicnLAogICAgICAgIGJsb2dJZDp0aGlzLmJsb2dJZCwKICAgICAgICBjb21tZW50Ont9CiAgICAgIH0KICAgICAgc3dpdGNoKHR5cGUpewogICAgICAgIGNhc2UgJ2ZhdGhlcic6CiAgICAgICAgICBjb21tZW50RGF0YS5jb21tZW50ID0gewogICAgICAgICAgICB1c2VyRGF0YTp7CiAgICAgICAgICAgICAgdXNlck5hbWU6dGhpcy51c2VyRGF0YS51c2VyTmFtZSwKICAgICAgICAgICAgICBhdmF0YXI6dGhpcy51c2VyRGF0YS5hdmF0YXIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udGVudDp0aGlzLmFydGljbGVDb21tZW50U3RyLAogICAgICAgICAgICBpc0NvbW1lbnQ6ZmFsc2UsCiAgICAgICAgICAgIGNvbW1lbnRzOltdCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmFydGljbGVDb21tZW50U3RyID0gJycKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3Nvbic6CiAgICAgICAgICBjb21tZW50RGF0YS5mYXRoZXJJZCA9IHRhcmdldC5jb21tZW50SWQKICAgICAgICAgIGNvbW1lbnREYXRhLmNvbW1lbnQgPSB7CiAgICAgICAgICAgIHVzZXJEYXRhOnsKICAgICAgICAgICAgICB1c2VyTmFtZTp0aGlzLnVzZXJEYXRhLnVzZXJOYW1lLAogICAgICAgICAgICAgIGF2YXRhcjp0aGlzLnVzZXJEYXRhLmF2YXRhcgogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250ZW50OnRoaXMuY29tbWVudFN0ciwKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuY29tbWVudFN0ciA9ICcnCiAgICAgICAgICB0YXJnZXQuaXNDb21tZW50ID0gZmFsc2UKICAgICAgICAgIHRoaXMuaXNDb21tZW50ID0gdHJ1ZQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgQmxvZ1NlcnZpY2UuY3JlYXRlQmxvZ0NvbW1lbnQoY29tbWVudERhdGEpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZihyZXMuZGF0YS5zdGF0dXMgPT09IDIwMCl7CiAgICAgICAgICBzd2l0Y2godHlwZSl7CiAgICAgICAgICAgIGNhc2UgJ2ZhdGhlcic6CiAgICAgICAgICAgICAgdGFyZ2V0LnB1c2gocmVzLmRhdGEuZGF0YS5jb21tZW50RGF0YSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnc29uJzoKICAgICAgICAgICAgICB0YXJnZXQuY29tbWVudHMucHVzaChyZXMuZGF0YS5kYXRhLmNvbW1lbnREYXRhKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHJlcy5kYXRhLm1lc3NhZ2UpCiAgICAgICAgfWVsc2V7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycihyZXMubWVzc2FnZSkKICAgICAgICB9CiAgICAgIH0pCgogICAgfQogIH0KfQo="},{"version":3,"sources":["Global-Comment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Global-Comment.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div>\r\n    <div\r\n      v-for='(commentItem, index) in localComment'\r\n      :key='index'\r\n      class=\"comment-card\"\r\n      style=\"margin-bottom: 20px;\"\r\n    >\r\n      <el-row :gutter=\"10\" >\r\n        <el-col :span=\"2\">\r\n          <el-avatar :src='commentItem.userData.avatar' size='large'></el-avatar>\r\n        </el-col>\r\n        <el-col :span=\"6\" style=\"font-size: 12px;\">\r\n          <span>{{commentItem.userData.userName}}</span>\r\n          <br>\r\n          <span>{{commentItem.lastModified | transformTime}}</span>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter=\"10\">\r\n        <el-col :span=\"24\" style=\"text-indent:2em;\">\r\n          {{commentItem.content}}\r\n        </el-col>\r\n        <el-col :span=\"24\" style=\"border-left:2px solid #ccc\">\r\n          <div\r\n            v-for='(sonCommentItem, index) in commentItem.comments'\r\n            :key='index'\r\n            style=\"margin: 20px; border-bottom: 1px dashed #ccc;\"\r\n          >\r\n            <el-row :gutter=\"10\" >\r\n              <el-col :span=\"2\">\r\n                <el-avatar :src='sonCommentItem.userData.avatar'  size='large'></el-avatar>\r\n              </el-col>\r\n              <el-col :span=\"6\" style=\"color:#409EFF;font-size: 12px;\">\r\n                <span>{{sonCommentItem.userData.userName}}</span>\r\n                <br>\r\n                <span>{{sonCommentItem.lastModified | transformTime}}</span>\r\n              </el-col>\r\n              <el-col :span=\"16\" style=\"text-indent:2em;\">\r\n                {{sonCommentItem.content}}\r\n              </el-col>\r\n            </el-row>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter=\"10\">\r\n        <el-col :span=\"6\">\r\n          <el-button type=\"text\" icon=\"el-icon-s-comment\" @click='switchComment(commentItem)'>回复</el-button>\r\n        </el-col>\r\n      </el-row>\r\n      <el-row :gutter='10' v-if='commentItem.isComment'>\r\n        <el-col :span=\"24\">\r\n          <el-input v-model='commentStr' placeholder=\"说点什么吧~\"></el-input>\r\n        </el-col>\r\n        <el-col :span=\"24\" style=\"text-align: right; margin-top: 10px;\">\r\n          <el-button type='primary' size=\"mini\" @click='cancelComment(commentItem,\"son\")'>取消</el-button>\r\n          <el-button type='primary' size=\"mini\" @click='addComment(commentItem,\"son\")'>回复</el-button>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n    <el-row :gutter='10' v-if='isComment'>\r\n      <el-col :span=\"24\">\r\n        <el-input v-model='articleCommentStr' placeholder=\"说点什么吧~\"></el-input>\r\n      </el-col>\r\n      <el-col :span=\"24\" style=\"text-align: right; margin-top: 10px;\">\r\n        <el-button type='primary' size=\"mini\" @click='cancelComment(localComment,\"father\")'>取消</el-button>\r\n        <el-button type='primary' size=\"mini\" @click='addComment(localComment,\"father\")'>回复</el-button>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import BlogService from '@/service/BlogService'\r\n  export default {\r\n    name: \"GlobalComment\",\r\n    props:{\r\n      blogId:{\r\n        type:Number,\r\n        default:0\r\n      },\r\n      comments:{\r\n        type:Array,\r\n        default(){\r\n          return []\r\n        }\r\n      }\r\n    },\r\n    watch:{\r\n      comments:{\r\n        handler(){\r\n          this.localComment = this.comments.slice(0)\r\n        },\r\n        immediate:true\r\n      }\r\n    },\r\n    data(){\r\n      return {\r\n        articleCommentStr:'',\r\n        commentStr:'',\r\n        localComment:[],\r\n        isComment:true,\r\n        userData:JSON.parse(sessionStorage.getItem('userData')),\r\n\r\n      }\r\n    },\r\n    filters:{\r\n      transformTime(time){\r\n        let blogCreateTime = new Date(time)\r\n        let currentTime = new Date()\r\n        let offsetTime = currentTime - blogCreateTime\r\n        let offsetST = offsetTime / 1000\r\n        let offsetMT = offsetST / 60\r\n        let offsetHT = offsetMT / 60\r\n        let offsetDT = offsetHT / 24\r\n        if(offsetDT >= 365){\r\n          return `发表于 ${Math.floor(offsetDT / 365)} 年之前`\r\n        }else if(offsetDT >= 30){\r\n          return `发表于 ${Math.floor(offsetDT / 30)} 个月之前`\r\n        }else if(offsetDT >= 7){\r\n          return `发表于 ${Math.floor(offsetDT / 7)} 周之前`\r\n        }else if(offsetDT >= 1){\r\n          return `发表于 ${Math.floor(offsetDT)} 天之前`\r\n        }else if(offsetHT >= 1){\r\n          return `发表于 ${Math.floor(offsetHT)} 小时之前`\r\n        }\r\n        else if(offsetMT >= 1){\r\n          return `发表于 ${Math.floor(offsetMT)} 分钟之前`\r\n        }\r\n        else if(offsetST >= 0){\r\n          // return `发表于 ${Math.floor(offsetST)} 秒钟之前`\r\n          return '刚刚'\r\n        }\r\n      }\r\n    },\r\n    methods:{\r\n      switchComment(commentItem){\r\n        this.localComment.forEach(item => {\r\n          if(item != commentItem){\r\n            item.isComment = false\r\n          }\r\n        })\r\n        commentItem.isComment = !commentItem.isComment\r\n          if(!commentItem.isComment){\r\n            this.isComment = true\r\n          }else{\r\n            this.isComment = false\r\n          }\r\n      },\r\n      cancelComment(target,type){\r\n        switch(type){\r\n          case 'father':\r\n            this.articleCommentStr = ''\r\n            break;\r\n          case 'son':\r\n            this.commentStr = ''\r\n            target.isComment = false\r\n            this.isComment = true\r\n            break;\r\n        }\r\n      },\r\n      addComment(target, type){\r\n        let commentData = {\r\n          fatherId:'',\r\n          blogId:this.blogId,\r\n          comment:{}\r\n        }\r\n        switch(type){\r\n          case 'father':\r\n            commentData.comment = {\r\n              userData:{\r\n                userName:this.userData.userName,\r\n                avatar:this.userData.avatar\r\n              },\r\n              content:this.articleCommentStr,\r\n              isComment:false,\r\n              comments:[]\r\n            }\r\n            this.articleCommentStr = ''\r\n            break;\r\n          case 'son':\r\n            commentData.fatherId = target.commentId\r\n            commentData.comment = {\r\n              userData:{\r\n                userName:this.userData.userName,\r\n                avatar:this.userData.avatar\r\n              },\r\n              content:this.commentStr,\r\n            }\r\n            this.commentStr = ''\r\n            target.isComment = false\r\n            this.isComment = true\r\n            break;\r\n        }\r\n        BlogService.createBlogComment(commentData).then(res => {\r\n          if(res.data.status === 200){\r\n            switch(type){\r\n              case 'father':\r\n                target.push(res.data.data.commentData)\r\n                break;\r\n              case 'son':\r\n                target.comments.push(res.data.data.commentData)\r\n                break;\r\n            }\r\n            this.$message.success(res.data.message)\r\n          }else{\r\n            this.$message.err(res.message)\r\n          }\r\n        })\r\n\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .comment-card{\r\n    padding:20px;\r\n    box-shadow: 0 2px 4px rgba(0,0,0,.5);\r\n  }\r\n</style>"]}]}